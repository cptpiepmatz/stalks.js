<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: stalks/weeks/Stalks.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: stalks/weeks/Stalks.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

const fetch = require("node-fetch");

const Week = require("./Week");

class Stalks {
  /**
   * @param {string} token - The authorization token.
   */
  constructor(token) {
    this._endpoint = "https://stalks.io/api"
    this._token = token;
  }

  /**
   * Get the header for fetch request.
   * @returns {{Authorization: string}} Header for the fetch.
   * @private
   */
  getAuthHeader() {
    let token = this._token;
    return { Authorization: "Token " + token};
  }

  /**
   * Get Stalks endpoint.
   * @returns {string} endpointString
   * @private
   */
  getEndpoint() {
    return this._endpoint;
  }

  /**
   * Get endpoint to work with Weeks.
   * @returns {string} endpointString
   * @private
   */
  getWeeksEndpoint() {
    return this._endpoint + "/stalks/weeks/";
  }

  /**
   * Fetches the current or a specific Week.
   * @param {DateResolvable} [date] - A date in the week.
   * @returns {Promise&lt;Week>}
   */
  fetchWeek(date) {
    if (typeof date === "undefined") date = new Date();
    let sundayDate = Week.getDateSunday(date);
    let url = this.getWeeksEndpoint()
      + "by_date/?date="
      + sundayDate.toISOString().substr(0, 10);
    let authHeader = this.getAuthHeader();
    return fetch(url, {
      method: "get",
      headers: authHeader
    }).then(res => res.json())
      .then(json => {
        return new Week({
          id: json.id,
          date: json.date,
          buys: json.buys,
          buy_local_first_time: json.buy_local_first_time,
          sells: json.sells,
          local_price: json.local_price,
          prices: json.prices,
          manual_previous_pattern: json.manual_previous_pattern,
          previous_pattern: json.previous_pattern,
          profit: json.profit,
          advice: json.advice,
          friend_weeks: json.friend_weeks,
          version: json.version
        })
      })
  }

  /**
   * Creates a Week.
   * @param {DateResolvable} [date]
   */
  createWeek(date) {
    if (typeof date === "undefined") date = new Date();
    let sundayDate = Week.getDateSunday(date);
    let week = new Week({
      date: sundayDate,
      buys: [],
      buy_local_first_time: null,
      local_price: null,
      prices: [],
      sells: []
    });
    let header = Object.assign(this.getAuthHeader(), { "Content-Type": "application/json"});
    fetch(this.getWeeksEndpoint(), {
      method: "post",
      headers: header,
      body: JSON.stringify(week)
    }).then(res => {
      console.log(res);
      return res.json()
    })
  }
}

module.exports = Stalks;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Advice.html">Advice</a></li><li><a href="Buy.html">Buy</a></li><li><a href="FriendWeek.html">FriendWeek</a></li><li><a href="Sell.html">Sell</a></li><li><a href="Stalks.html">Stalks</a></li><li><a href="Week.html">Week</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Sun Jun 14 2020 12:46:46 GMT+0200 (Mitteleurop√§ische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
